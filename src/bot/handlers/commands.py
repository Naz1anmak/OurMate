"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.
–°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ —Ç–∏–ø–∞ /start, /help –∏ —Ç.–¥.
"""
from aiogram import types
from aiogram.exceptions import TelegramNetworkError
from aiogram.filters import Command

from src.bot.services.birthday_service import birthday_service
from src.utils.log_utils import log_with_ts as _log

async def cmd_start(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start.
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    
    Args:
        message (types.Message): –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π
    """
    # –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    user_login = f"@{message.from_user.username}" if message.from_user.username else ""
    _log(f"FP; –û—Ç {user_login} ({message.from_user.full_name}): /start")
    
    # –û—Ç–º–µ—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–≤—à–∏–º –±–æ—Ç–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ
    from src.config.settings import OWNER_CHAT_ID
    user_record = next((u for u in birthday_service.users if u.user_id == message.from_user.id), None)
    if user_record and not user_record.interacted_with_bot:
        user_record.interacted_with_bot = True
        birthday_service.save_users()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
    
    if message.from_user.id == OWNER_CHAT_ID:
        # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
        welcome_text = """
ü§ñ <b>–ü—Ä–∏–≤–µ—Ç, –≤–ª–∞–¥–µ–ª–µ—Ü!</b>

–Ø –±–æ—Ç —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é. –ü–æ–º–∏–º–æ –æ–±—ã—á–Ω–æ–≥–æ —á–∞—Ç–∞, —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º:

<b>–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</b>
‚Ä¢ <code>logs</code> ‚Äî –õ–æ–≥–∏ –±–æ—Ç–∞
‚Ä¢ <code>full logs</code> ‚Äî –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏
‚Ä¢ <code>status</code> ‚Äî –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
‚Ä¢ <code>system</code> ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
‚Ä¢ <code>stop bot</code> ‚Äî –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
‚Ä¢ <code>–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫</code> ‚Äî –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Å—ã–ª–æ–∫/–∞–∫—Ç–∏–≤–∞—Ü–∏–∏
‚Ä¢ <code>help</code> –∏–ª–∏ <code>–∫–æ–º–∞–Ω–¥—ã</code> ‚Äî –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

<b>–ö–æ–º–∞–Ω–¥—ã –ø–æ –¥–Ω—è–º —Ä–æ–∂–¥–µ–Ω–∏—è:</b>
‚Ä¢ <code>–¥—Ä</code> ‚Äî –ë–ª–∏–∂–∞–π—à–∏–π –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è
‚Ä¢ <code>–¥—Ä &lt;user_id&gt;</code> –∏–ª–∏ <code>–¥—Ä @username</code> ‚Äî –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ id –∏–ª–∏ username

<b>–ö–æ–º–∞–Ω–¥—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:</b>
‚Ä¢ <code>–ø–∞—Ä—ã</code> ‚Äî –ü–∞—Ä—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–≤ –≥—Ä—É–ø–ø–µ, –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –±–æ—Ç–∞)
‚Ä¢ <code>–ø–∞—Ä—ã –∑–∞–≤—Ç—Ä–∞</code> ‚Äî –ü–∞—Ä—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞ (–≤ –≥—Ä—É–ø–ø–µ, –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –±–æ—Ç–∞)

<b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π:</b>
‚Ä¢ <code>–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è</code> ‚Äî –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è (–≤ –õ–° —Å –±–æ—Ç–æ–º)

<b>–û–±—ã—á–Ω—ã–π —á–∞—Ç:</b>
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —è –æ—Ç–≤–µ—á—É —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–∏.
        """
    else:
        # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        welcome_text = """
ü§ñ <b>–ü—Ä–∏–≤–µ—Ç!</b>

–Ø –±–æ—Ç —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é. –ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –º–Ω–µ –≤–æ–ø—Ä–æ—Å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –µ–≥–æ —Ç—É—Ç, –∞ –≤ –≥—Ä—É–ø–ø–µ —É–ø–æ–º—è–Ω–∏ –º–µ–Ω—è —á–µ—Ä–µ–∑ @ –∏–ª–∏ –æ—Ç–≤–µ—Ç—å –Ω–∞ –º–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ.

üí¨ –Ø –∑–∞–ø–æ–º–∏–Ω–∞—é –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤, –ø–æ—ç—Ç–æ–º—É –º–æ–≥—É –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—É—é –±–µ—Å–µ–¥—É.

<b>–í –≥—Ä—É–ø–ø–µ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö:</b>
‚Ä¢ <code>help</code> –∏–ª–∏ <code>–∫–æ–º–∞–Ω–¥—ã</code> ‚Äî –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
‚Ä¢ <code>–¥—Ä</code> ‚Äî –ë–ª–∏–∂–∞–π—à–∏–π –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è
‚Ä¢ <code>–¥—Ä 123456789</code> –∏–ª–∏ <code>–¥—Ä @username</code> ‚Äî –î–∞—Ç–∞ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ id –∏–ª–∏ username
‚Ä¢ <code>–ø–∞—Ä—ã</code> ‚Äî –ü–∞—Ä—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
‚Ä¢ <code>–ø–∞—Ä—ã –∑–∞–≤—Ç—Ä–∞</code> ‚Äî –ü–∞—Ä—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞
‚Ä¢ <code>–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è</code> ‚Äî –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è (–≤ –õ–° —Å –±–æ—Ç–æ–º)
<i>‚ùï –ù—É–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å –±–æ—Ç–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.</i>

<b>–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É):</b>
‚Ä¢ <code>logs</code> ‚Äî –õ–æ–≥–∏ –±–æ—Ç–∞
‚Ä¢ <code>full logs</code> ‚Äî –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏
‚Ä¢ <code>status</code> ‚Äî –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
‚Ä¢ <code>system</code> ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
‚Ä¢ <code>stop bot</code> ‚Äî –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
‚Ä¢ <code>–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫</code> ‚Äî –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Å—ã–ª–æ–∫/–∞–∫—Ç–∏–≤–∞—Ü–∏–∏

<b>–•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π?</b>
–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è —Å –¥–Ω—è–º–∏ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ –≤–∞—à–µ–π –±–µ—Å–µ–¥–µ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±—É–¥—É—â–∏—Ö –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è, –≤—ã –º–æ–∂–µ—Ç–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –±–æ—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Å–µ–±—è:

üîó <a href="https://github.com/Naz1anmak/OurMate">GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</a>
        """
    
    try:
        await message.answer(welcome_text, parse_mode="HTML")
    except TelegramNetworkError as exc:
        _log(
            f"PM; –ë–æ—Ç: –æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –¥–ª—è {user_login or message.from_user.id}: {exc}"
        )
    except Exception as exc:
        _log(
            f"PM; –ë–æ—Ç: –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –¥–ª—è {user_login or message.from_user.id}: {exc}"
        )

def register_command_handlers(dp):
    """
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ.
    
    Args:
        dp: –î–∏—Å–ø–µ—Ç—á–µ—Ä aiogram
    """
    dp.message.register(cmd_start, Command("start"))
